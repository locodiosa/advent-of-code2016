<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script>
		"use strict";
    
    function calc() {      
      document.getElementById("result").innerHTML = getResult();      
    }         
    
    function getResult() {
      var column = {
        floors: parseInput(),
        elevator: 0
      };
      
      var result = 0;

      while (!checkEnd(column.floors)) {
        doMove(column);           
        ++result;
      } 

      return result;            
    }

    function parseInput() {
      var floors = [];

      input.split("\n").forEach(function(line) {       
        var floor = [];

        line.split(" a ").forEach(function(str) {
          if (str.indexOf("floor ") == -1) {                 
            floor.push(createObject(str));            
          }                    
        });

        floors.push(floor);        
      });   

      return floors;
    } 


    function createObject(str) {
      if (str.indexOf("microchip") != -1) {
        return {
          name: str.slice(0, str.indexOf("-")),
          type:"microchip"          
        };

      } else if (str.indexOf("generator") != -1) {
        return {
          name: str.slice(0, str.indexOf(" ")),
          type: "generator"
        };
      }     

      return null;
    }

    function doMove(column) {      
      if ((column.elevator == 0) || (column.floors[column.elevator - 1].length == 0)) {
        doMoveUp(column);
      } else {
        doMoveDown(column);
      }
    }

    function doMoveUp(column) {
      for (var j = 0; j < column.floors[column.elevator].length - 1; ++j) {       
        for (var i = j + 1; i < column.floors[column.elevator].length; ++i) {         
           
          if (checkElevator(column.floors[column.elevator][j], column.floors[column.elevator][i]) == true) {            
            var newCurrentFloor = [];
            var newNextFloor = column.floors[column.elevator + 1];
            
            for (var k = 0; k < column.floors[column.elevator].length; ++k) {
              if (k != j && k != i) {
                newCurrentFloor.push(column.floors[column.elevator][k]);
              } else {
                newNextFloor.push(column.floors[column.elevator][k]);
              }
            }                           
 
            if ((checkFloor(newCurrentFloor) == true) && (checkFloor(newNextFloor) == true)) { 
              column.floors[column.elevator] = newCurrentFloor;
              column.floors[column.elevator + 1] = newNextFloor;              
              column.elevator++;

              return true;
            }
          }
        }
      }
    }

    function doMoveDown(column) {
      for (var j = 0; j < column.floors[column.elevator].length - 1; ++j) { 
        var newCurrentFloor = [];
        var newNextFloor = column.floors[column.elevator - 1];

        for (var k = 0; k < column.floors[column.elevator].length; ++k) {
          if (k != j) {            
            newCurrentFloor.push(column.floors[column.elevator][k]);
          
          } else {                   
            newNextFloor.push(column.floors[column.elevator - 1][k]);
          }
        }                               
 
        if ((checkFloor(newCurrentFloor) == true) && (checkFloor(newNextFloor) == true)) { 
          column.floors[column.elevator] = newCurrentFloor;
          column.floors[column.elevator - 1] = newNextFloor;
          column.elevator--;

          return true;

        } else {
          newNextFloor.pop();
        }          
      }
    }

    function checkElevator(j, i) {
      if ((j.name == i.name) || (j.type == i.type)) {
        
        return true;
      
      } else {
        
        return false;
      }
    }

    function checkFloor(floor) {
      var aloneObjects = [];

      for (var j = 0; j < floor.length; ++j) {       
        for (var i = 0; i < floor.length; ++i) {

          if (floor[j].name != floor[i].name) {
            aloneObjects.push(floor[j]);
          }
        }
      }

      if ((aloneObjects.length == 0) || (aloneObjects.length == 1)) {
        return true;

      } else {
        for (var j = 0; j < aloneObjects.length - 1; ++j) {
          if (aloneObjects[j].type == aloneObjects[j + 1].type) {
            
            return true;

          } else {

            return false;
          }
        }
      }
    }

    function checkEnd(floors) {
      for (var i = 0; i < floors.length - 1; ++i) {
        if (floors[i].length != 0) {

          return false;
        }
      }

      return true;
    }

  var input = `The first floor contains a strontium generator, a strontium-compatible microchip, a plutonium generator, and a plutonium-compatible microchip.
The second floor contains a thulium generator, a ruthenium generator, a ruthenium-compatible microchip, a curium generator, and a curium-compatible microchip.
The third floor contains a thulium-compatible microchip.
The fourth floor contains nothing relevant.`
	</script>
</head>
<body onload="calc()">
  <div id="result"></div>
</body>
</html>