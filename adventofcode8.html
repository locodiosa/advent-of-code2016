<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script>
		"use strict";

    var newScreen = initScreen(50, 6);
    var wide, tall, x, y, stepX, stepY;
    var counter = 0;

    function draw(newScreen) {
      var canvas  = document.getElementById("canvas");
      canvas.width  = newScreen.length * 10; 
      canvas.height = newScreen[0].length * 10; 
        
      var context = canvas.getContext('2d');
      context.fillStyle   = '#eee'; 
      context.fillRect(0, 0, canvas.width, canvas.height);  
        
      context.beginPath();
      getResult(context)
      context.stroke(); 
    }

    function calc() {      
      document.getElementById("result").innerHTML = draw(newScreen);      
    }  

    function fillScreen(context, newScreen, wide, tall) {        
      context.fillStyle = '#000';    
      for (var i = 0; i < wide; i++) {  

        for (var j = 0; j < tall; j++) {
          newScreen[i][j] = 1;          
          var x = i * 10;
          var y = j * 10;
          context.fillRect(x,y,7,7);
        }
      }              
    }     

    function getResult(context) {   
      input.split("\n").forEach(function(line) {

        if (line.indexOf("rect") != -1) {
          wide = parseInt(line.slice(5, line.indexOf("x")));
          tall = parseInt(line.slice(line.indexOf("x") + 1));          
          fillScreen(context, newScreen, wide, tall);
        }      
        
        if (line.indexOf("rotate row") != -1) {         
          y = parseInt(line.slice(13, line.indexOf("b") - 1));         
          stepX = parseInt(line.slice(line.indexOf("b") + 3));           
          fillRow(context, newScreen, wide, y, stepX);          
        }

        if (line.indexOf("rotate column") != -1) {          
          x = parseInt(line.slice(16, line.indexOf("b") - 1));         
          stepY = parseInt(line.slice(line.indexOf("b") + 3));           
          fillColumn(context, newScreen, tall, x, stepY);         
        }

      });
      

      console.log("counter = " + counter);
    } 

    function initScreen(x, y) {
      var newScreen = new Array(x);

      for (var i = 0; i < newScreen.length; i++) {
        newScreen[i] = new Array(y);
      }

      for (var i = 0; i < newScreen.length; i++) {
        for (var j = 0; j < newScreen[i].length; j++) {
          newScreen[i][j] = 0;
        }
      }

      return newScreen;
    }

    function fillRow(context, newScreen, wide, y, stepX) {
      for (var i = 0; i < newScreen.length; i++) {                      
       
        if (i + stepX >= newScreen.length) { 
          if (newScreen[i][y] == 1) {
            newScreen[i][y] = 0;
            counter--; 
            x = i * 10;          
            context.fillStyle = '#eee';                   
            context.fillRect(x,y,7,7); 
          } else if (newScreen[i][y] == 2) {
            newScreen[i][y] = 1;                        
          }

          if (newScreen[i + stepX - newScreen.length][y] == 0) {
            newScreen[i + stepX - newScreen.length][y] = 1; 
            counter++;       
            var x = (i + stepX - newScreen.length) * 10;  
            var y = y * 10;
            context.fillStyle = '#000';  
            context.fillRect(x,y,7,7);          
          } else if (newScreen[i + stepX - newScreen.length][y] == 1) {
            newScreen[i + stepX - newScreen.length][y] = 2;            
          }
          
        } else {
          if (newScreen[i][y] == 0) { 
            newScreen[i + stepX][y] = 1; 
            counter++;
            x = (i + stepX) * 10;
            y = y * 10;
            context.fillStyle = '#000';  
            context.fillRect(x,y,7,7); 
          } else if {
            
          }

          if (newScreen[i][y] == 1) {
            newScreen[i][y] = 0; 
            counter--;
            x = i * 10;          
            context.fillStyle = '#eee';                   
            context.fillRect(x,y,7,7);
          }
        }

                     
        }               
      }          
    }

    function fillColumn(context, newScreen, tall, x, stepY) {
      for (var i = 0; i < tall; i++) {                      
       
        if (i + stepY >= newScreen[0].length) {                     
          if (newScreen[x][i] == 1) {
            newScreen[x][i] = 0; 
            counter--;
            var coordY = i * 10;          
            context.fillStyle = '#eee';                   
            context.fillRect(x,coordY,7,7); 
          } else if (newScreen[x][i] == 2) {
            newScreen[x][i] = 1;           
          }

          if (newScreen[x][i + stepY - newScreen[0].length] == 0) {
            newScreen[x][i + stepY - newScreen[0].length] = 1;     
            counter++;   
            coordY = (i + stepY - newScreen[0].length) * 10;  
            var coordX = x * 10;
            context.fillStyle = '#000';  
            context.fillRect(coordX,coordY,7,7);          
          } else if (newScreen[x][i + stepY - newScreen[0].length] == 1) {
            newScreen[x][i + stepY - newScreen[0].length] = 2;           
          }
          
        } else { 
          if (newScreen[x][i + stepY] == 0) {         
            newScreen[x][i + stepY] = 1; 
            counter++;
            coordY = (i + stepY) * 10;
            coordX = x * 10;
            context.fillStyle = '#000';  
            context.fillRect(coordX,coordY,7,7); 
          } else if (newScreen[x][i + stepY] == 1) {
            newScreen[x][i + stepY] = 2;            
          }
          console.log("tall=" + tall + ", x=" + x + ", stepY =" + stepY);

          if (newScreen[x][i] == 1) {
            newScreen[x][i] = 0; 
            counter--;
            coordY = i * 10;          
            context.fillStyle = '#eee';                   
            context.fillRect(coordX,coordY,7,7); 
          } else if (newScreen[x][i] == 2) {
            newScreen[x][i] = 1;           
          }                  
        }               
      }          
    }

                 

    
    

  var input = `rect 1x1
rotate row y=0 by 7
rect 1x1
rotate row y=0 by 5
rect 1x1
rotate row y=0 by 5
`


	</script>
</head>
<body onload="calc()">
<div id="result"></div>
<canvas id="canvas"></canvas>

</body>
</html>